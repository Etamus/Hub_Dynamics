<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub Spare Parts - Dashboards</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <link rel="stylesheet" href="/static/css/hub.css">
    <link rel="stylesheet" href="/static/css/shared.css">
    <link rel="stylesheet" href="/static/css/dashboards.css">
</head>
<body>
    <script>
      // (Script de carregamento de tema mantido)
      (function() {
        try {
          const savedTheme = localStorage.getItem('hubTheme') || 'light';
          if (savedTheme === 'dark') {
            document.body.classList.add('theme-dark');
          } else if (savedTheme === 'light') {
            // Nenhuma classe necessária
          } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.body.classList.add('theme-dark');
            }
          }
        } catch (e) {
          // Ignora erros
        }
      })();
    </script>
        <script>
            (function() {
                try {
                    const storedUser = localStorage.getItem('hubUsername') || '_default';
                    const savedLanguage = localStorage.getItem(`hubLanguage_${storedUser}`) || localStorage.getItem('hubLanguage_default') || 'pt';
                    document.documentElement.setAttribute('lang', savedLanguage === 'en' ? 'en' : 'pt-br');
                    document.documentElement.dataset.hubLang = savedLanguage;
                } catch (error) {
                    document.documentElement.setAttribute('lang', 'pt-br');
                }
            })();
        </script>

    <header class="internal-header">
        <a href="/" class="internal-logo" title="Hub Spare Parts">
            <img src="/static/icones/hub_logo.png" alt="Hub Spare Parts" class="logo-light">
            <img src="/static/icones/hub_logo_branco.png" alt="Hub Spare Parts" class="logo-dark">
            <div class="internal-logo-text">
                <span>Hub Spare Parts</span>
                <small>Dashboards</small>
            </div>
        </a>
        <div class="internal-header-tools">
            <a href="/" id="back-btn" class="header-icon-btn back-button" title="Voltar ao Hub"><i class="fas fa-home"></i></a>
            <button id="fullscreen-btn" class="header-icon-btn fullscreen-button" title="Tela Cheia"><i class="fas fa-expand"></i></button>
            <div class="access-container">
                <button id="access-btn" class="access-button" aria-label="Acesso" title="Acesso">
                    <img id="profile-img" src="{{ profile_image or '/static/icones/default_profile.png' }}" alt="Perfil" class="profile-image-thumb">
                </button>
                <div class="access-dropdown" id="access-dropdown"></div>
            </div>
        </div>
    </header>

    <section class="internal-search-stack">
        <div class="tabs-wrapper">
            <div class="main-nav-tabs">
                {% if role == 'Executor' %}
                <a href="/automacao" class="nav-tab" data-page="automacao" title="Automações">
                    <i class="fas fa-robot"></i>
                    <span>Automações</span>
                </a>
                {% else %}
                <div class="nav-tab disabled" title="Acesso restrito a Executores">
                    <i class="fas fa-robot"></i>
                    <span>Automações</span>
                </div>
                {% endif %}

                <a href="/dashboards" class="nav-tab active" data-page="dashboards" title="Dashboards">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboards</span>
                </a>

                {% if role == 'Executor' or role == 'Analista' %}
                <a href="/drive" class="nav-tab" data-page="drive" title="Drive Online">
                    <i class="fas fa-hdd"></i>
                    <span>Drive Online</span>
                </a>
                {% else %}
                <div class="nav-tab disabled" title="Faça login para acessar o Drive">
                    <i class="fas fa-hdd"></i>
                    <span>Drive Online</span>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="page-search-container">
            <label for="dashboards-search-input" class="visually-hidden">Buscar dashboard</label>
            <i class="fas fa-search page-search-icon"></i>
            <input type="text" id="dashboards-search-input" class="page-search-input" placeholder="Buscar dashboard...">
            <div class="page-search-shortcut-hint" aria-hidden="true">
                <span class="shortcut-key">Ctrl</span>
                <span class="shortcut-key">K</span>
            </div>
        </div>
    </section>

    <div id="selection-screen">
        
        <div class="system-selector">
            {% for system_key, system_data in dashboards_data.items() %}
                <label>
                    <input type="radio" name="dashboard_system" value="{{ system_key }}" {{ 'checked' if loop.first }}>
                    
                    {% if system_key == 'looker' %}
                        <img src="/static/icones/looker_logo.png" alt="Logo Looker Studio" class="logo-light">
                        <img src="/static/icones/lookerblack_logo.png" alt="Logo Looker Studio" class="logo-dark">
                    {% elif system_key == 'library' %}
                        <img src="/static/icones/library_logo.png" alt="Logo Library" class="logo-light">
                        <img src="/static/icones/libraryblack_logo.png" alt="Logo Library" class="logo-dark">
                    
                    {% elif system_key == 'tableau' %}
                        <img src="/static/icones/tableau_logo.png" alt="Logo Tableau" class="logo-light">
                        <img src="/static/icones/tableaublack_logo.png" alt="Logo Tableau" class="logo-dark">
                    {% else %}
                        <img src="{{ system_data.icon }}" alt="Logo {{ system_data.system_name }}">
                    {% endif %}
                    </label>
            {% endfor %}
        </div>
        
        
        {% for system_key, system_data in dashboards_data.items() %}
        
            <div id="{{ system_key }}-options" class="dashboard-options hidden">
                
                <div id="{{ system_key }}-area-selection" class="dashboard-options area-selection-container">
                    {% for area_key, area_data in system_data.areas.items() %}
                        <button class="area-button" data-area="{{ area_key }}">{{ area_data.name }}</button>
                    {% endfor %}
                </div>
                
                {% if system_key == 'looker' %}
                <div id="looker-pagination" class="pagination-controls">
                    <button id="looker-prev-page" class="page-button" title="Anterior">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="looker-page-info" class="page-info">Página 1 de X</span>
                    <button id="looker-next-page" class="page-button" title="Próxima">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                {% endif %}
                
                {% for area_key, area_data in system_data.areas.items() %}
                    <div id="dashboards-{{ area_key }}" class="dashboard-options hidden">
                        
                        {% for item in area_data['items'] %}
                            <button class="view-button"
                                data-id="{{ item.id }}"
                                data-url="{{ item.url }}"
                                {% if item.width %}data-width="{{ item.width }}"{% endif %}
                                data-preview-gif="{{ item.gif }}"
                                data-preview-text="{{ item.text }}"
                                data-preview-tags="{{ item.tags }}">
                                {{ item.name }}
                            </button>
                        {% endfor %}
                        
                        <button class="back-to-areas-button" title="Voltar para Áreas"><i class="fas fa-arrow-left"></i></button>
                    </div>
                {% endfor %}
                
            </div>
        
        {% endfor %}
        
    </div>

    <div id="login-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button id="login-modal-close-btn" class="modal-close" title="Fechar">&times;</button>
            
            <img id="modal-logo-tableau-light" src="/static/icones/tableau_logo.png" alt="Logo Tableau" class="modal-logo logo-light hidden">
            <img id="modal-logo-tableau-dark" src="/static/icones/tableaublack_logo.png" alt="Logo Tableau" class="modal-logo logo-dark hidden">
            
            <p id="modal-subtitle">Insira suas credenciais para logar.</p>
            <div class="modal-form">
                <div class="modal-input-group">
                    <label for="modal-user">Usuário:</label>
                    <input type="text" id="modal-user">
                </div>
                <div class="modal-input-group">
                    <label for="modal-pass">Senha:</label>
                    <input type="password" id="modal-pass">
                </div>
                <button id="modal-execute-btn" class="button btn-execute">Logar</button>
                
                {% if is_hub_logged_in %}
                <button id="modal-save-conn-btn" class="button btn-save-conn">Adicionar Conexão</button>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="dashboard-view" class="dashboard-container"></div>
    
    <div id="preview-panel">
        <img id="preview-image" src="" alt="Preview do Dashboard">
        <p id="preview-description"></p>
        <div id="preview-tags-container"></div>
    </div>

    {% include 'partials/access_modals.html' %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script src="/static/js/shared.js" defer></script>
    <script src="/static/js/hub.js" defer></script>
    <script src="/static/js/dashboards.js" defer></script>
</body>
</html>