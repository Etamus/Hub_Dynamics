<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Hub Spare Parts</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css"> <link rel="stylesheet" href="/static/css/hub.css">
    <link rel="stylesheet" href="/static/css/shared.css">
    <style>
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
    <script>
      // Script de carregamento instantâneo do tema (para evitar flicker)
      (function() {
        try {
          const savedTheme = localStorage.getItem('hubTheme') || 'light';
          if (savedTheme === 'dark') {
            document.body.classList.add('theme-dark');
          } else if (savedTheme === 'light') {
            // Nenhuma classe necessária para o padrão 'light'
          } else {
            // Checa o tema do sistema
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.body.classList.add('theme-dark');
            }
          }
        } catch (e) {
          // Ignora erros (ex: localStorage desativado)
        }
      })();
    </script>
        <script>
            // Define o atributo de idioma o mais cedo possível
            (function() {
                try {
                    const storedUser = localStorage.getItem('hubUsername') || '_default';
                    const savedLanguage = localStorage.getItem(`hubLanguage_${storedUser}`) || localStorage.getItem('hubLanguage_default') || 'pt';
                    document.documentElement.setAttribute('lang', savedLanguage === 'en' ? 'en' : 'pt-br');
                    document.documentElement.dataset.hubLang = savedLanguage;
                } catch (error) {
                    document.documentElement.setAttribute('lang', 'pt-br');
                }
            })();
        </script>
    
    <div class="top-header">
        <div class="logo-title">
            <img src="/static/icones/hub_logo.png" alt="" class="logo-light">
            <img src="/static/icones/hub_logo_branco.png" alt="" class="logo-dark">
            <span>Hub Spare Parts</span>
        </div>

        <div class="search-container">
            <label for="search-bar" class="visually-hidden">Pesquisar ferramenta</label>
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-bar" placeholder="Pesquisar ferramenta...">

             <div id="search-dropdown-results" class="search-dropdown">
                </div>
        </div>
        <div class="header-tools">
            
            <button id="about-btn" aria-label="Sobre" title="Sobre"><i class="fas fa-question-circle"></i></button>
            <button id="settings-btn" aria-label="Configurações" title="Configurações"><i class="fas fa-cog"></i></button>
            <button id="fullscreen-btn" aria-label="Tela Cheia" title="Tela Cheia"><i class="fas fa-expand"></i></button>
            <div class="access-container">
                <button id="access-btn" class="access-button" aria-label="Acesso" title="Acesso">
                    <img id="profile-img" src="{{ profile_image or '/static/icones/default_profile.png' }}" alt="Perfil" class="profile-image-thumb">
                </button>
                <div class="access-dropdown" id="access-dropdown">
                    </div>
            </div>
        </div>
    </div>
    
    <div class="hub-container">

        <div class="hub-subtitle">
            <p><i class="fas fa-info-circle"></i> <span>Selecione a ferramenta que deseja utilizar</span></p>
        </div>
        
        <div class="hub-cards" id="hub-cards-container">
            {% if role == 'Executor' %}
            <a href="/automacao" class="hub-card" aria-label="Automações. Execute robôs para tarefas de SAP, BW e extração de relatórios.">
                <div class="card-media-area">
                    <div class="card-preview"> <img src="/static/gifs/automacao_preview.gif" alt="Preview Automações"> </div>
                    <div class="card-content">
                        <div class="card-icon"><i class="fas fa-robot" aria-hidden="true"></i></div>
                        <h2>Automações</h2>
                    </div>
                </div>
                <p>Execute robôs para tarefas de SAP, BW e extração de relatórios.</p>
            </a>
            {% else %}
                <div class="hub-card disabled">
                    <div class="card-media-area">
                        <div class="card-content">
                            <div class="card-icon"><i class="fas fa-robot" aria-hidden="true"></i></div>
                            <h2>Automações</h2>
                        </div>
                    </div>
                    
                    {% if role %}
                        <p>Solicite para ter acesso.</p>
                    {% else %}
                        <p>Faça login para ter acesso.</p>
                    {% endif %}
                    
                </div>
            {% endif %}

            <a href="/dashboards" class="hub-card" aria-label="Dashboards. Acesse o portal com os dashboards do Looker Studio e Tableau.">
                <div class="card-media-area">
                    <div class="card-preview"> <img src="/static/gifs/dashboards_preview.gif" alt="Preview Dashboards"> </div>
                    <div class="card-content">
                        <div class="card-icon"><i class="fas fa-chart-pie" aria-hidden="true"></i></div>
                        <h2>Dashboards</h2>
                    </div>
                </div>
                <p>Acesse o portal com os dashboards do Looker Studio e Tableau.</p>
            </a>

            {% if role == 'Executor' or role == 'Analista' %}
            <a href="/drive" class="hub-card" aria-label="Drive (F:) Online. Navegue pelas pastas da rede sem necessidade de uso da VPN.">
                <div class="card-media-area">
                    <div class="card-preview"> <img src="/static/gifs/drive_preview.gif" alt="Preview Drive"> </div>
                    <div class="card-content">
                        <div class="card-icon"> <i class="fas fa-hdd" aria-hidden="true"></i> </div>
                        <h2>Drive (F:) Online</h2>
                    </div>
                </div>
                <p>Navegue pelas pastas da rede sem necessidade de uso da VPN.</p>
            </a>
            {% else %}
                <div class="hub-card disabled">
                    <div class="card-media-area">
                        <div class="card-content">
                            <div class="card-icon"> <i class="fas fa-hdd" aria-hidden="true"></i> </div>
                            <h2>Drive (F:) Online</h2>
                        </div>
                    </div>
                    <p>Faça login para ter acesso.</p> </div>
            {% endif %}

        </div>
        
        <div class="quick-links-section" id="quick-links-section">
            <h3>Acesso Rápido</h3>
            <div class="quick-links-container" id="quick-links-container">
                </div>
        </div>

    </div>
    
    <div class="settings-modal-overlay" id="settings-overlay">
        <div class="settings-modal">
            <div class="settings-header">
                <h2>Configurações</h2>
                <button class="settings-close-btn" id="settings-close-btn">&times;</button>
            </div>
            <div class="setting-group">
                    <label>Aparência</label>
                    <div class="theme-selector">
                        <div class="theme-option" data-theme="light" title="Modo Claro">
                            <i class="fas fa-sun"></i>
                            <span>Claro</span>
                        </div>
                        <div class="theme-option" data-theme="dark" title="Modo Escuro">
                            <i class="fas fa-moon"></i>
                            <span>Escuro</span>
                        </div>
                        <div class="theme-option" data-theme="system" title="Padrão do Sistema">
                            <i class="fas fa-desktop"></i>
                            <span>Sistema</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>Quantidade de Cards</label>
                    <div class="count-selector">
                        <div class="setting-option" data-count="4">
                            <span>4 Espaços</span>
                        </div>
                        <div class="setting-option" data-count="6">
                            <span>6 Espaços</span>
                        </div>
                        <div class="setting-option" data-count="8">
                            <span>8 Espaços</span>
                        </div>
                    </div>

                    <button class="button-danger" id="clear-recents-btn">
                        <i class="fas fa-trash-alt"></i>
                        Limpar Cards
                    </button>
                </div>
                </div>
        </div>
    </div>

    <div class="settings-modal-overlay" id="about-overlay">
        <div class="settings-modal">
            <div class="settings-header">
                <h2>Sobre</h2>
                <button class="settings-close-btn" id="about-close-btn">&times;</button>
            </div>
            <div class="settings-body" id="config-body">
                <div class="about-section">
                    <p><strong>Versão Atual:</strong> v1.5.3</p>
                    <p><strong>Responsáveis pelo Projeto:</strong></p>
                    <ul>
                        <li>Mateus Lopes (<a href="https://github.com/Etamus" target="_blank" rel="noopener noreferrer">GitHub</a>)</li>
                        <li>Jonathan Paixão (<a href="https://github.com/Jonathan-Paixao" target="_blank" rel="noopener noreferrer">GitHub</a>)</li>
                    </ul>
                </div>
                
                <div class="devlog-container">
                    <label>Histórico de Versões</label>
                    <ul>
                        <li><strong>v1.5.3:</strong> Readequação do número da versão atual e atualização do layout de janelas</li>
                        <li><strong>v1.4.8:</strong> Lançamento do novo design de janelas do Hub</li>
                        <li><strong>v1.3.3:</strong> Layout alterado por completo, melhorias de perfil e correções</li>
                        <li><strong>v1.2.8:</strong> Melhoria de layout e nova seleção de tela nas páginas</li>
                        <li><strong>v1.2.3:</strong> Melhorias no Drive F: Online e alterações nos icones das páginas</li>
                        <li><strong>v1.2.1:</strong> Novo perfil de usuário e correção de "alert" da janela de registro</li>
                        <li><strong>v1.1.9:</strong> Correção de icones e melhoria do modo escuro</li>
                        <li><strong>v1.1.7:</strong> Adição de novas lógicas de "@media" para atualização do modo mobile</li>
                        <li><strong>v1.1.0:</strong> Adicionado login para Tableau no Dashboards e correção da quebra de linha do Chatbot</li>
                        <li><strong>v1.0.5:</strong> Barra de pesquisa aprimorada e novo preview na página de automações</li>
                        <li><strong>v1.0.2:</strong> Atualização da lógica e prompt do Chatbot</li>
                        <li><strong>v1.0.0:</strong> Melhoria no desbloqueio de usuário e informações do drive F:</li>
                        <li><strong>v0.9.5:</strong> Adicionado botão de criação de usuário na tela de administração</li>
                        <li><strong>v0.9.0:</strong> Janela de administração aprimorada e correções de problemas</li>
                        <li><strong>v0.8.9:</strong> Melhoria de layout da página incial e lógica da barra de pesquisa</li>
                        <li><strong>v0.8.7:</strong> Novo Chatbot com integração de inteligência artificial</li>
                        <li><strong>v0.7.7:</strong> Melhorias no Agendador de Tarefas</li>
                        <li><strong>v0.7.5:</strong> Novo layout, funcionalidades e correções gerais</li>
                        <li><strong>v0.7.0:</strong> Melhorias no registro, tela de administração e lógica dos perfis</li>
                        <li><strong>v0.6.0:</strong> Novo registro de usuário, consulta e sistema de perfis</li>
                        <li><strong>v0.5.0:</strong> Mudanças de placeholders e ajustes de icones no agendamento de tarefas</li>
                        <li><strong>v0.4.9:</strong> Melhorias no perfil de usuário do hub</li>
                        <li><strong>v0.4.7:</strong> Agendador de tarefas aprimorado e correções de estrutura</li>
                        <li><strong>v0.4.5:</strong> Acesso de usuário, conexões e melhorias na página de automatizações</li>
                        <li><strong>v0.3.5:</strong> Qualidade de vida, correções de instabilidade e melhorias nas páginas</li>
                        <li><strong>v0.3.0:</strong> Adicionado Barra de Pesquisa na Página Inicial</li>
                        <li><strong>v0.2.5:</strong> Adição de apresentações 'Processo de devolução' ao Library</li>
                        <li><strong>v0.2.4:</strong> Adição de arquivos 'google apresentações' ao Library. Adição do label data 'Gardem'.</li>
                        <li><strong>v0.2.3:</strong> Início da preparação para port mobile.</li>
                        <li><strong>v0.2.2:</strong> Adição de label referenciando a qual indicador o dashboard atende.</li>
                        <li><strong>v0.2.1:</strong> Adição de preview aos dashboards pendentes</li>
                        <li><strong>v0.1.6:</strong> Correção: Oculta o chatbot ao visualizar dashboards do Looker para evitar sobreposição</li>
                        <li><strong>v0.1.5:</strong> Correção: Adiciona sistema de paginação e preview latera com etiquetas</li>
                        <li><strong>v0.1.4:</strong> Correção do servidor_unico.py</li>
                        <li><strong>v0.1.3:</strong> Remoção de Arquivos Desnecessários</li>
                        <li><strong>v0.1.2:</strong> Atualizações Gerais e Novos Aprimoramentos</li>
                        <li><strong>v0.1.0:</strong> Atualização Inicial</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <div class="settings-modal-overlay" id="hub-login-overlay">
        <div class="settings-modal" style="max-width: 340px;">
            <div class="settings-header">
                <h2>Acesso ao Hub</h2> <button class="settings-close-btn" id="hub-login-close-btn">&times;</button>
            </div>
            <div class="settings-body" style="padding: 20px 30px 30px;">
                <p id="hub-login-error" class="hub-form-error hidden"></p>
                <div class="modal-input-group" style="margin-bottom: 15px;">
                    <label for="hub-user">Usuário:</label>
                    <input type="text" id="hub-user" class="hub-modal-input">
                </div>
                <div class="modal-input-group" style="margin-bottom: 25px;">
                    <label for="hub-pass">Senha:</label>
                    <input type="password" id="hub-pass" class="hub-modal-input">
                </div>
                <button class="button-full-width" id="hub-login-submit-btn">Entrar</button>
            </div>
        </div>
    </div>

    <div class="settings-modal-overlay" id="connections-overlay">
        <div class="settings-modal" style="max-width: 400px;">
            <div class="settings-header">
                <h2>Minhas Conexões</h2>
                <button class="settings-close-btn" id="connections-close-btn">&times;</button>
            </div>
            <div class="settings-body" id="connections-list-container">
                </div>
        </div>
    </div>

    <div class="settings-modal-overlay" id="profile-overlay">
        <div class="settings-modal">
            <div class="settings-header">
                <h2>Minha Conta</h2>
                <button class="settings-close-btn" id="profile-close-btn">&times;</button>
            </div>
            <div class="settings-body" style="padding: 20px 30px 30px; text-align: center;">
                <img id="profile-preview-img" src="/static/icones/default_profile.png" alt="Prévia do Perfil" class="profile-preview-large">
                <p class="profile-username-display">Carregando...</p>

                <div class="profile-user-details">
                    <span id="profile-role-display"></span> | <span id="profile-area-display"></span>
                </div>
                <form id="profile-upload-form" enctype="multipart/form-data" style="margin-top: 20px;">
                    <input type="file" id="profile-file-input" name="file" accept="image/png, image/jpeg" class="visually-hidden"> 
                    
                    <label for="profile-file-input" class="button-full-width button-secondary profile-button">
                        <i class="fas fa-upload"></i> Escolher Imagem
                    </label>

                    <button type="button" id="profile-remove-btn" class="button-danger profile-button hidden">
                        <i class="fas fa-trash-alt"></i> Remover Imagem
                    </button>

                    <p id="profile-upload-status" style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary-color);"></p>
                </form>
            </div>
        </div>
    </div>
    <div class="settings-modal-overlay" id="cropper-overlay">
                <div class="settings-modal cropper-modal-styling"> 
                        <div class="settings-body" style="padding: 5px 20px 0;">
                <button class="settings-close-btn" id="cropper-close-btn" style="position: absolute; top: 15px; right: 20px; z-index: 10;">&times;</button>
                <div class="cropper-container">
                    <img id="cropper-image" style="max-width: 100%;" src="" alt="Imagem para Recortar">
                </div>
                    </div>
            <div class="profile-form-footer" id="cropper-footer">
                <button class="button btn-cancel" id="cropper-close-footer-btn">Fechar</button>
                <button class="button btn-save" id="cropper-save-btn">Recortar e Salvar</button>
            </div>
        </div>
    </div>

    <div class="settings-modal-overlay" id="edit-name-overlay">
        <div class="settings-modal" style="max-width: 400px;">
            <div class="settings-header">
                <h2>Alterar Nome</h2>
                <button class="settings-close-btn" id="edit-name-close-btn">&times;</button>
            </div>
            <div class="settings-body" style="padding: 20px 30px 30px;">
                <div class="modal-input-group">
                    <label for="edit-name-input">Nome de Usuário:</label>
                    <input type="text" id="edit-name-input" class="hub-modal-input" maxlength="16">
                </div>
                <button id="edit-name-save-btn" class="button-full-width btn-success" style="margin-top: 20px;">Salvar</button>
            </div>
        </div>
    </div>

    <div class="settings-modal-overlay" id="register-overlay">
    <div class="settings-modal" style="max-width: 450px;">
        <div class="settings-header">
            <h2>Solicitar Acesso</h2>
            <button class="settings-close-btn" id="register-close-btn">&times;</button>
        </div>
        <div class="scheduler-queue-tabs" style="padding-left: 20px;">
            <span id="tab-register" class="scheduler-tab active" data-tab="register">Preenchimento</span>
            <span id="tab-consult" class="scheduler-tab" data-tab="consult">Consulta</span>
        </div>
        
        <div id="register-tab-content" class="settings-body" style="padding: 10px 30px 30px;">
            
            <div id="register-form">
                <div id="register-fields">
                    <p id="register-status" class="hub-form-error hidden" style="text-align: center; margin-top: -5px;"></p>
                    <div class="modal-input-group" style="margin-bottom: 15px;">
                        <label for="register-user">Login de Funcionário:</label>
                        <input type="text" id="register-user" class="hub-modal-input" placeholder="Ex: LOPESM21" maxlength="10">
                    </div>
                    
                    <div class="scheduler-datetime-group" style="gap: 15px;">
                        <div class="modal-input-group" style="margin-bottom: 15px;">
                            <label for="register-area">Área:</label>
                            <select id="register-area" class="hub-modal-input">
                                <option value="" disabled selected hidden>Selecione...</option>
                                <option value="Logística">Logística</option>
                                <option value="Comercial">Comercial</option>
                                <option value="Financeiro">Financeiro</option>
                                <option value="Jurídico">Jurídico</option>
                                <option value="Vendas">Vendas</option>
                            </select>
                        </div>
                        <div class="modal-input-group" style="margin-bottom: 15px;">
                            <label for="register-role">Função:</label>
                            <select id="register-role" class="hub-modal-input">
                                <option value="" disabled selected hidden>Selecione...</option>
                                <option value="Analista">Analista</option>
                                <option value="Executor">Executor</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="register-submit-btn" class="button-full-width" style="width: 40%; margin-top: 15px;">Solicitar</button>

                </div>

                <div id="register-token-display" class="hidden" style="text-align: center;">
                    <p style="color: var(--text-secondary-color); margin-top: -10px;">Sua solicitação foi enviada!</p>
                    <p style="color: var(--text-primary-color); font-weight: 500;">Guarde este token para consultar seu status:</p>
                    <div class="token-display" id="token-generated"></div>
                    </div>
            </div>
        </div>
        
        <div id="consult-tab-content" class="settings-body hidden" style="padding: 10px 30px 30px;">

            <p id="consult-status-error" class="hub-form-error hidden" style="text-align: center; margin-top: -5px"></p>

            <div class="modal-input-group" style="margin-bottom: 15px;">
                <label for="consult-token">Insira seu Token de Acesso:</label>
                <input type="text" id="consult-token" class="hub-modal-input">
            </div>
            <button id="consult-token-btn" class="button-full-width" style="width: 40%; margin-top: 30px;">Consultar</button>

            <div id="consult-status-wrapper" class="hidden" style="margin-top: 25px; text-align: left;">
                <hr style="border-color: var(--border-color); border-top: 0;">
                <p style="font-weight: 600; color: var(--text-primary-color);">Status da Solicitação:</p>
                <div class="consult-status-box" id="consult-status-result"></div>
                <p id="consult-justification" class="hidden" style="font-size: 0.9rem; color: var(--text-secondary-color);"></p>
                
                <div id="consult-new-password-section" class="hidden">
                    <p id="consult-password-error" class="hub-form-error hidden"></p>
                    <div class="modal-input-group" style="margin-bottom: 15px;">
                        <label for="consult-new-password">Defina sua nova senha:</label>
                        <input type="password" id="consult-new-password" class="hub-modal-input" maxlength="20">
                    </div>
                    <button id="consult-save-password-btn" class="button-full-width" style="width: 40%; margin-top: 30px;">Salvar</button>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <div class="settings-modal-overlay" id="admin-overlay">
        <div class="settings-modal admin-modal">
            <div class="admin-modal-grid">
                <aside class="admin-sidebar">
                    <div class="scheduler-queue-tabs admin-sidebar-nav" role="tablist">
                        <button id="tab-admin-requests" class="scheduler-tab active" data-tab="requests">
                            <i class="fas fa-inbox"></i>
                            <span>Solicitações</span>
                            <span class="admin-tab-badge hidden" id="admin-requests-count">0</span>
                        </button>
                        <button id="tab-admin-users" class="scheduler-tab" data-tab="users">
                            <i class="fas fa-users"></i>
                            <span>Usuários</span>
                        </button>
                        <button id="tab-admin-dashboards" class="scheduler-tab" data-tab="dashboards">
                            <i class="fas fa-display"></i>
                            <span>Dashboards</span>
                        </button>
                        <button id="tab-admin-automations" class="scheduler-tab" data-tab="automations">
                            <i class="fas fa-robot"></i>
                            <span>Automações</span>
                        </button>
                    </div>
                    <div class="admin-sidebar-footer">
                        <button class="admin-close-btn" id="admin-close-btn">
                            Fechar
                        </button>
                    </div>
                </aside>
                <section class="admin-panel">
                    <div class="admin-panel-card">
                        <header class="admin-panel-header">
                            <div>
                                <h3 id="admin-active-title">Solicitações</h3>
                                <p id="admin-active-description">Acompanhe pedidos pendentes e responda com rapidez.</p>
                            </div>
                            <div id="admin-search-container" class="admin-search-container hidden">
                                <div id="admin-search-input-wrapper" class="admin-search-input-wrapper">
                                    <i class="fas fa-search admin-search-icon"></i>
                                    <input type="text" id="admin-search-input" class="admin-search-input" placeholder="Pesquisar...">
                                </div>
                            </div>
                        </header>
                        <div class="admin-panel-body">
                            <div id="admin-requests-tab" class="admin-panel-section">
                                <div id="admin-list-container" class="admin-panel-surface"></div>
                            </div>
                            
                            <div id="admin-users-tab" class="admin-panel-section hidden">
                                <div id="admin-user-list-container" class="admin-panel-surface"></div>
                            </div>

                            <div id="admin-dashboards-tab" class="admin-panel-section hidden">
                                <button class="admin-add-btn" id="admin-add-dashboard-btn">
                                    <i class="fas fa-chart-pie"></i>
                                    <span>Novo</span>
                                </button>
                                <div id="admin-dashboards-list" class="admin-panel-surface admin-cms-list"></div>
                            </div>
                            
                            <div id="admin-automations-tab" class="admin-panel-section hidden">
                                <button class="admin-add-btn" id="admin-add-automation-btn">
                                    <i class="fas fa-robot"></i>
                                    <span>Novo</span>
                                </button>
                                <div id="admin-automations-list" class="admin-panel-surface admin-cms-list"></div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script> <script src="/static/js/shared.js" defer></script>
    <script src="/static/js/hub.js" defer></script>
    
</body>
</html>