<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Hub Spare Parts - Automação</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="/static/css/automacao.css">
    <link rel="stylesheet" href="/static/css/shared.css">
</head>
<body>
    <script>
      // Script de carregamento instantâneo do tema (para evitar flicker)
      (function() {
        try {
          const savedTheme = localStorage.getItem('hubTheme') || 'light';
          if (savedTheme === 'dark') {
            document.body.classList.add('theme-dark');
          } else if (savedTheme === 'light') {
            // Nenhuma classe necessária para o padrão 'light'
          } else {
            // Checa o tema do sistema
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.body.classList.add('theme-dark');
            }
          }
        } catch (e) {
          // Ignora erros
        }
      })();
    </script>

    <div class="main-nav-tabs">
        
        {% if role == 'Executor' %}
        <a href="/automacao" class="nav-tab" data-page="automacao" title="Automações">
            <i class="fas fa-robot"></i>
            <span>Automações</span>
        </a>
        {% else %}
        <div class="nav-tab disabled" title="Acesso restrito a Executores">
            <i class="fas fa-robot"></i>
            <span>Automações</span>
        </div>
        {% endif %}

        <a href="/dashboards" class="nav-tab" data-page="dashboards" title="Dashboards">
            <i class="fas fa-chart-pie"></i>
            <span>Dashboards</span>
        </a>

        {% if role == 'Executor' or role == 'Analista' %}
        <a href="/drive" class="nav-tab" data-page="drive" title="Drive (F:) Online">
            <i class="fas fa-hdd"></i>
            <span>Drive</span>
        </a>
        {% else %}
        <div class="nav-tab disabled" title="Faça login para acessar o Drive">
            <i class="fas fa-hdd"></i>
            <span>Drive</span>
        </div>
        {% endif %}
        
    </div>

    <div class="page-header-separator"></div>

    <button id="logout-btn" class="logout-button hidden" title="Deslogar"><i class="fas fa-sign-out-alt"></i></button>

    <button id="scheduler-btn" class="scheduler-button" title="Agendador"><i class="fas fa-clock"></i></button>

    <button id="theme-toggle-btn" class="theme-toggle-button" aria-label="Alternar Tema" title="Alternar Tema">
        <i class="fas fa-sun"></i> 
    </button>

    <button id="fullscreen-btn" class="fullscreen-button" title="Tela Cheia"><i class="fas fa-expand"></i></button>

    <a href="/" class="back-button" title="Voltar ao Hub"><i class="fas fa-home"></i></a>
    
    <div id="status" class="status-box" aria-live="polite"></div>
    
    <div class="container">
        <div class="page-search-container">
            <i class="fas fa-search page-search-icon"></i>
            <input type="text" id="automacao-search-input" placeholder="Buscar automação...">
        </div>
        <p class="subtitle" id="main-subtitle"><i class="fas fa-info-circle"></i> <span id="subtitle-text">Selecione o sistema para executar uma tarefa</span></p>
        
        <div class="system-selector">
            <label>
                <input type="radio" name="login_system" value="sap" checked>
                <img src="/static/icones/sap_logo.png" alt="Logo SAP" class="logo-light">
                <img src="/static/icones/sapblack_logo.png" alt="Logo SAP" class="logo-dark">
            </label>
            <label> <input type="radio" name="login_system" value="bw"> <img src="/static/icones/bwhana_logo.png" alt="Logo BW HANA"> </label>
        </div>

        <div id="sap-tasks-section" class="tasks-section">
    <div class="button-container">
        {% for nome, config in macros.items() %}
            {% if config.type == 'sap' %} 
                {% if nome == "Base Mãe" %}
                    <div class="task-button-group">
                        <div class="task-button" 
                             data-task-name="{{ nome }}" 
                             data-task-type="sap"
                             data-preview-gif="{{ config.gif | default('', true) }}"
                             data-preview-text="{{ config.text | default('', true) }}"
                             data-preview-tags="{{ config.tags | default('', true) }}">
                            <div class="button-text">{{ nome }}</div>
                        </div>
                        {% if initial_zv62n_file %}
                            <a href="/download/{{ initial_zv62n_file }}" class="task-button-download" title="Baixar {{ initial_zv62n_file }}">
                                <i class="fas fa-file-arrow-down"></i>
                            </a>
                        {% else %}
                            <a href="#" class="task-button-download inactive" title="Arquivo não encontrado.">
                                <i class="fas fa-file-arrow-down"></i>
                            </a>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="task-button" 
                         data-task-name="{{ nome }}" 
                         data-task-type="sap"
                         data-preview-gif="{{ config.gif | default('', true) }}"
                         data-preview-text="{{ config.text | default('', true) }}"
                         data-preview-tags="{{ config.tags | default('', true) }}">
                        <div class="button-text">{{ nome }}</div>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
</div>
        
        <div id="bw-tasks-section" class="tasks-section hidden">
    <div class="button-container">
        {% for nome, config in macros.items() %}
            {% if config.type == 'bw' %} 
                <div id="bw-extract-btn" 
                     class="task-button" 
                     data-task-name="{{ nome }}" 
                     data-task-type="bw"
                     data-preview-gif="{{ config.gif | default('', true) }}"
                     data-preview-text="{{ config.text | default('', true) }}"
                     data-preview-tags="{{ config.tags | default('', true) }}">
                    <div class="button-text">{{ nome }}</div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
    
<div id="preview-panel">
        <img id="preview-image" src="" alt="Preview da Automação">
        <p id="preview-description"></p>
        <div id="preview-tags-container"></div>
    </div>

    <div id="login-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button id="login-modal-close-btn" class="modal-close" title="Fechar">&times;</button>
            
            <img id="modal-logo-sap-light" src="/static/icones/sap_logo.png" alt="Logo SAP" class="modal-logo logo-light hidden">
            <img id="modal-logo-sap-dark" src="/static/icones/sapblack_logo.png" alt="Logo SAP" class="modal-logo logo-dark hidden">
            <img id="modal-logo-bw" src="/static/icones/bwhana_logo.png" alt="Logo BW HANA" class="modal-logo hidden">
            
            <p id="modal-subtitle">Insira suas credenciais para logar.</p>
            <div class="modal-form">
                <div class="modal-input-group">
                    <label for="modal-user">Usuário:</label>
                    <input type="text" id="modal-user">
                </div>
                <div class="modal-input-group">
                    <label for="modal-pass">Senha:</label>
                    <input type="password" id="modal-pass">
                </div>
                <button id="modal-execute-btn" class="button btn-execute">Logar</button>
                
                {% if is_hub_logged_in %}
                <button id="modal-save-conn-btn" class="button btn-save-conn">Adicionar Conexão</button>
                {% endif %}
                </div>
        </div>
    </div>

    <div id="confirm-modal-overlay" class="modal-overlay"> 
        <div class="modal-content">
                    <h2 id="confirm-modal-title">Deseja deslogar?</h2>
            <div class="modal-button-container">
                <button id="confirm-modal-no-btn" class="button btn-cancel">Não</button>
                <button id="confirm-modal-yes-btn" class="button btn-danger">Sim</button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/automacao.js" defer></script>
    <script src="/static/js/shared.js" defer></script>
</body>
</html>